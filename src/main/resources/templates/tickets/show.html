<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org/">

<head>
	<th:block th:replace="~{fragments/fragments :: head}"></th:block>
	<title>[[${ticket.title}]]</title>
</head>

<body class="bg-primary-subtle">
	<nav th:replace="~{fragments/navbar :: navbar('show')}"></nav>
	<main class="container" th:object="${ticket}">
		<div class="row justify-content-center mb-4">
			<div class="col-12 col-lg-8">
				<h2 class="text-center mt-2 mb-4">[[*{title}]]</h2>
				<!--redirect message-->
				<th:block th:if="${editMessage != null}">
					<th:block th:replace="~{fragments/alerts :: edit-alert(${editMessage})}"></th:block>
				</th:block>
				<div class="row py-2 mb-2 fs-6 text-center border border-primary rounded light-blue-background">
					<div class="col-12 col-md-3 d-flex align-items-center justify-content-center">
						<span class="fw-medium me-1">Priority:</span>
						<span class="fw-semibold fst-italic">[[*{priority}]]</span>
					</div>
					<div class="col-12 col-md-3 d-flex align-items-center justify-content-center">
						<span class="fw-medium me-1">Category: </span>
						<span class="fw-semibold fst-italic text-capitalize">[[*{category.name}]]</span>
					</div>
					<div class="col-12 col-md-3 d-flex align-items-center justify-content-center">
						<span class="fw-medium me-1">User: </span>
						<span class="fw-semibold fst-italic text-capitalize">[[*{user.name}]]
							[[*{user.lastname}]]</span>
					</div>
					<div class="col-12 col-md-3 d-flex align-items-center justify-content-center">
						<span class="fw-medium me-1">Status:</span>
						<span class="fw-semibold fst-italic">[[*{status.name}]]</span>
					</div>
				</div>


				<div class="row fs-5 border border-primary rounded light-blue-background mb-4 p-2">
					<div class="col-12">
						<div class="fs-6 d-flex justify-content-between mb-2">
							<div>
								<span class="fw-medium">Create Date: </span>
								<span>[[*{formattedCreatedAt}]]</span>
							</div>
							<div>
								<span class="fw-medium">Last Update: </span>
								<span>[[*{formattedUpdatedAt}]]</span>
							</div>
						</div>
						<div>[[*{content}]]</div>
					</div>
				</div>

				<div class="row fs-5 border border-primary rounded justify-content-center light-blue-background mb-4"
					th:if="${ticket.notes.size() > 0}">
					<div class="col-12">

						<div th:each="note : ${ticket.notes}">
							<div class="fs-6 d-flex justify-content-between my-2 p-2">
									<div>
										<span class="fw-medium">Date: </span>
										<span>[[${note.formattedDate}]]</span>
									</div>
									<!--TODO th:username-->
									<div>
										<span class="fw-medium">Written By: </span>
										<span class="text-danger">Insert username</span>
									</div>
							</div>
							<div>[[${note.content}]]</div>
							<hr>
						</div>
					</div>
				</div>

				<div class="row justify-content-center">
					<!-- Button show note input -->
					<div class="d-flex justify-content-end">
						<button class="btn btn-orange me-2 border border-1 border-light">
							<a class="text-decoration-none text-reset"
								th:href="@{/edit/{id} (id=${ticket.id})}">Edit</a>
						</button>
						<!-- Button trigger modal -->
						<button type="button" class="btn btn-danger me-2 border border-1 border-light"
							data-bs-toggle="modal" data-bs-target="#deleteModal">
							Delete
						</button>

						<!-- Delete Modal -->
						<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel"
							aria-hidden="true">
							<div class="modal-dialog">
								<div class="modal-content">
									<div class="modal-header">
										<h1 class="modal-title fs-5 text-danger" id="deleteModalLabel">Delete ticket
											[[${ticket.title}]]</h1>
										<button type="button" class="btn-close" data-bs-dismiss="modal"
											aria-label="Close"></button>
									</div>
									<div class="modal-body">
										Deletion is a definitive action and cannot be reversed<br>
										Are you sure you want to delete ticket [[${ticket.title}]]?
									</div>
									<div class="modal-footer">
										<button type="button" class="btn btn-secondary border border-1 border-light"
											data-bs-dismiss="modal">Close</button>
										<form method="post" th:action="@{/delete/{id} (id=${ticket.id})}">
											<button class="btn btn-danger me-2 border border-1 border-light"
												type="submit">Delete</button>
										</form>
									</div>
								</div>
							</div>
						</div>

						<button type="button" class="btn btn-primary border border-1 border-light"
							data-bs-toggle="collapse" data-bs-target="#collapseExample">
							New note
						</button>
					</div>
					<div class="collapse" id="collapseExample">
						<form method="post" th:action="@{{ticketId}/note (ticketId=${ticket.id})}">

							<div class="mb-3">
								<label for="note-content" class="form-label">New note</label>
								<textarea class="form-control" id="note-content" th:field="${note.content}"
									rows="5"></textarea>
							</div>
							<div class="d-flex justify-content-end">
								<button type="submit" class="btn btn-success border border-1 border-light">Add
									note</button>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
	</main>
	<script th:replace="~{fragments/fragments :: scripts}"></script>
</body>

</html>